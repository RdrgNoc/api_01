'use strict';

var idUser = $("#MainContent_hddnIdUsuario").val();
var idRolUser = $("#MainContent_hddnPage").val();
var cveOSd = $("#MainContent_hddnOS").val().trim();
var cveUPd = $("#MainContent_hddnUP").val().trim();
var cveEfiscald = $("#MainContent_hddnEfiscal").val().trim();

const d = new Date();
const numberMonth = parseInt(d.getMonth()) + 1;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

var obtenerSelectDatosEfiscal = function () {
    fetchDataArr(0, {}, 9, function (response) {
        if (response) {
            const select = $("#cboEfiscal");
            select.empty();
            select.append($("<option>", { value: "0", text: "SELECCIONE" }));
            response.forEach(function (item) { select.append($("<option>", { value: item.id_efiscal, text: item.efiscal })); });
            select.val(cveEfiscald);
        } else if (response === "error") {
            showMsg("Error al cargar datos", 'error');
        }
    });
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function gDao(eFiscal) {
    var html = '';
    fetchDataArr(1, { _eFiscal: eFiscal }, 9, function (response) {
        if (response) {
            logger.log("%cDatos devueltos de REPORTES GLOBALES ENLACE DE RIESGOS", "color: rgba(255, 50, 50, 0.2); font-weight: bold; background: #111; padding: 4px;");
            logger.table(response);
            if (response !== 'error') {
                if (response.length !== 0) {
                    response.forEach(function (item) {
                        var sumHtml = "";
                        var disabledBtn = "";

                        html += `<tr>
                                        <td class='text-1000'>${item.EFISCAL}</td>
                                        <td class='text-1000'>${item.Descripcion_elemento}</td>
                                        <td class='text-1000'>${item.NO_CONTROL_ASIGN === null ? 'Por asignar' : item.NO_CONTROL_ASIGN}</td>
                                        <td class='text-1000'>${item.DESC_AREA_OPORTUNIDAD}</td>
                                        <td class='text-end'>
                                            <div>
                                                <button class='btn btn-sm btn-falcon-warning btnEditArea customButton m-1 ${disabledBtn}' type='button' data-ctrl-reporte='${item.ID_CTRL_AREA_OPORTUNIDAD}'>Editar área</button>
                                            </div>
                                        </td>
                                    </tr>`
                    });
                    recargarTabla("tableAreasOportunidadA", html);
                } else {
                    recargarTabla("tableAreasOportunidadA", null);
                    showMsg("Registre al menos un reporte para iniciar.", 'info');
                }
            } else {
                showMsg("Ocurrio un error al mostrar resultados.", 'error');
            }
        } else if (response === "error") {
            showMsg("Error al cargar datos", 'error');
        }
    });
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$(document).ready(function () {
    loadEndpoints(9);
    obtenerSelectDatosEfiscal();
    if (idRolUser === '101') {

    } else if (idRolUser === '102') {
        gDao(cveEfiscald)
    } else if (idRolUser === '103') {

    }

    $(document).on("change", "#cboEfiscal", async function () {
        var eFiscal = $("#cboEfiscal").val();
        if (idRolUser === '101') {
        } else if (idRolUser === '102') {
            if (verifyInitialDataE(eFiscal)) { gDao(eFiscal); }
        } else if (idRolUser === '103') {

        }
    });


    $(document).on("click", "#btnSearch", function () {
        var eFiscal = $("#cboEfiscal").val();
        if (idRolUser === '101') {

        } else if (idRolUser === '102') {
            if (verifyInitialDataE(eFiscal)) { gDao(eFiscal); }
        } else if (idRolUser === '103') {

        }
    });
});

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function clearForms(type) {
    if (type === 1) {
        $("#fileCer").val('');
        $("#fileKey").val('');
        $("#txtPassFiel").val('');
    } else if (type === 2) {
    } else if (type === 3) {
    } else if (type === 4) {
    } else if (type === 5) {
    } else if (type === 6) {
    }
}